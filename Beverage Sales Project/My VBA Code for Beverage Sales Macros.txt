MACRO FOR PIVOT TABLES
Sub GeneratePivotTablesKeyMetrics()    Dim wsSource As Worksheet, wsPivot As Worksheet    Dim srcTable As ListObject    Dim pvtCache As PivotCache    Dim pvtTable As PivotTable    Dim startRow As Long    ' Set worksheets    Set wsSource = ThisWorkbook.Sheets("Data")    Set wsPivot = ThisWorkbook.Sheets("Pivot")    ' Set the source table    On Error Resume Next    Set srcTable = wsSource.ListObjects("Retailers")    On Error GoTo 0    If srcTable Is Nothing Then        MsgBox "The table 'salesdata' does not exist on the 'Retailers0' sheet.", vbCritical        Exit Sub    End If    ' Clear existing content on the Pivot sheet    wsPivot.Cells.Clear    ' Set starting row for pivot tables    startRow = 1    ' Create Pivot Cache    Set pvtCache = ThisWorkbook.PivotCaches.Create( _        SourceType:=xlDatabase, _        SourceData:=wsSource.Name & "!" & srcTable.Range.Address)    ' 1. Total Revenue: Sum of Revenue column    Set pvtTable = wsPivot.PivotTables.Add(PivotCache:=pvtCache, _        TableDestination:=wsPivot.Cells(startRow, 1))    With pvtTable        .AddDataField .PivotFields("Revenue"), "Sum of Revenue", xlSum        .PivotFields("Sum of Revenue").NumberFormat = "$#,##0.00"    End With    wsPivot.Cells(startRow, 1).Value = "Total Revenue"    startRow = startRow + pvtTable.TableRange2.Rows.Count + 2    ' 2. Total Units Sold: Sum of Units Sold column    Set pvtTable = wsPivot.PivotTables.Add(PivotCache:=pvtCache, _        TableDestination:=wsPivot.Cells(startRow, 1))    With pvtTable        .AddDataField .PivotFields("Units Sold"), "Sum of Units Sold", xlSum    End With    wsPivot.Cells(startRow, 1).Value = "Total Units Sold"    startRow = startRow + pvtTable.TableRange2.Rows.Count + 2    ' 3. Average Price per Unit: Average of Price per Unit column    Set pvtTable = wsPivot.PivotTables.Add(PivotCache:=pvtCache, _        TableDestination:=wsPivot.Cells(startRow, 1))    With pvtTable        .AddDataField .PivotFields("Price per Unit"), "Average Price per Unit", xlAverage        .PivotFields("Average Price per Unit").NumberFormat = "$#,##0.00"    End With    wsPivot.Cells(startRow, 1).Value = "Average Price per Unit"    startRow = startRow + pvtTable.TableRange2.Rows.Count + 2    ' 4. Top Beverage by Revenue: Beverage with the highest sum of revenue    Set pvtTable = wsPivot.PivotTables.Add(PivotCache:=pvtCache, _        TableDestination:=wsPivot.Cells(startRow, 1))    With pvtTable        .PivotFields("Beverage Brand").Orientation = xlRowField        .AddDataField .PivotFields("Revenue"), "Total Revenue", xlSum        .PivotFields("Total Revenue").NumberFormat = "$#,##0.00"        .RowAxisLayout xlTabularRow        .PivotFields("Revenue").AutoSort xlDescending, "Total Revenue"        ' Filter to show only the top 1 beverage by revenue        Dim pvtItem As PivotItem        For Each pvtItem In .PivotFields("Beverage Brand").PivotItems            If pvtItem.Name = "Dasani Water" Then                pvtItem.Visible = True            Else                pvtItem.Visible = False            End If        Next pvtItem    End With    wsPivot.Cells(startRow, 1).Value = "Top Beverage by Revenue"    startRow = startRow + pvtTable.TableRange2.Rows.Count + 2    ' 5. Average Days to Payment    Set pvtTable = wsPivot.PivotTables.Add(PivotCache:=pvtCache, _        TableDestination:=wsPivot.Cells(startRow, 1))    With pvtTable        .AddDataField .PivotFields("Days to Payment"), "Average Days to Payment", xlAverage        .PivotFields("Average Days to Payment").NumberFormat = "#,##0.00"    End With    wsPivot.Cells(startRow, 1).Value = "Average Days to Payment"    startRow = startRow + pvtTable.TableRange2.Rows.Count + 2    ' Notify the user    MsgBox "Pivot tables created successfully on the 'Pivot' sheet!", vbInformationEnd Sub




------------------------------------------------------

MACRO FOR PIVOT CHARTS

Sub GeneratePivotTablesAndGraphs()    Dim wsData As Worksheet, wsCharts As Worksheet    Dim srcTable As ListObject    Dim pvtCache As PivotCache    Dim pvtTable As PivotTable    Dim chartObj As ChartObject    Dim topPosition As Double, chartHeight As Double, chartWidth As Double, chartSpacing As Double    Dim startRow As Long    ' Define chart settings    chartHeight = 300 ' Height of each chart    chartWidth = 500 ' Width of each chart    chartSpacing = 20 ' Space between charts    ' Set worksheet references    Set wsData = ThisWorkbook.Sheets("Data")    Set wsCharts = ThisWorkbook.Sheets("Charts")    ' Clear existing content and charts in "Charts" sheet    wsCharts.Cells.Clear    For Each chartObj In wsCharts.ChartObjects        chartObj.Delete    Next chartObj    ' Get the source table    Set srcTable = wsData.ListObjects("Retailers")    ' Create Pivot Cache    Set pvtCache = ThisWorkbook.PivotCaches.Create(SourceType:=xlDatabase, SourceData:=srcTable.Range)    ' Start placing pivot tables at the top of "Charts" sheet    startRow = 1    ' 1. Create Pivot Table: Revenue by Beverage Brand    Set pvtTable = wsCharts.PivotTables.Add(PivotCache:=pvtCache, TableDestination:=wsCharts.Cells(startRow, 1))    pvtTable.Name = "PivotTable1"    With pvtTable        .PivotFields("Beverage Brand").Orientation = xlRowField        .AddDataField .PivotFields("Revenue"), "Total Revenue", xlSum    End With    startRow = startRow + pvtTable.TableRange2.Rows.Count + 2    ' 2. Create Pivot Table: Revenue by Month    Set pvtTable = wsCharts.PivotTables.Add(PivotCache:=pvtCache, TableDestination:=wsCharts.Cells(startRow, 1))    pvtTable.Name = "PivotTable2"    With pvtTable        .PivotFields("Month Name").Orientation = xlRowField        .AddDataField .PivotFields("Revenue"), "Total Revenue", xlSum    End With    startRow = startRow + pvtTable.TableRange2.Rows.Count + 2    ' 3. Create Pivot Table: Units Sold by Beverage Brand    Set pvtTable = wsCharts.PivotTables.Add(PivotCache:=pvtCache, TableDestination:=wsCharts.Cells(startRow, 1))    pvtTable.Name = "PivotTable3"    With pvtTable        .PivotFields("Beverage Brand").Orientation = xlRowField        .AddDataField .PivotFields("Units Sold"), "Total Units Sold", xlSum    End With    startRow = startRow + pvtTable.TableRange2.Rows.Count + 2    ' 4. Create Pivot Table: Revenue by State    Set pvtTable = wsCharts.PivotTables.Add(PivotCache:=pvtCache, TableDestination:=wsCharts.Cells(startRow, 1))    pvtTable.Name = "PivotTable4"    With pvtTable        .PivotFields("State").Orientation = xlRowField        .AddDataField .PivotFields("Revenue"), "Total Revenue", xlSum    End With    startRow = startRow + pvtTable.TableRange2.Rows.Count + 2    ' 5. Create Pivot Table: Price per Unit Over Time    Set pvtTable = wsCharts.PivotTables.Add(PivotCache:=pvtCache, TableDestination:=wsCharts.Cells(startRow, 1))    pvtTable.Name = "PivotTable5"    With pvtTable        .PivotFields("Month Name").Orientation = xlRowField        .PivotFields("Beverage Brand").Orientation = xlColumnField        .AddDataField .PivotFields("Price per Unit"), "Average Price per Unit", xlAverage    End With    startRow = startRow + pvtTable.TableRange2.Rows.Count + 2    ' Now create the corresponding charts for each pivot table    ' 1. Create Bar Chart: Revenue by Beverage Brand    CreateChartFromPivot wsCharts, "PivotTable1", xlColumnClustered, "Revenue by Beverage Brand", 10, 10, chartWidth, chartHeight    topPosition = topPosition + chartHeight + chartSpacing    ' 2. Create Line Chart: Revenue by Month    CreateChartFromPivot wsCharts, "PivotTable2", xlLineMarkers, "Revenue by Month", 10, topPosition, chartWidth, chartHeight    topPosition = topPosition + chartHeight + chartSpacing    ' 3. Create Stacked Bar Chart: Units Sold by Beverage Brand    CreateChartFromPivot wsCharts, "PivotTable3", xlBarStacked, "Units Sold by Beverage Brand", 10, topPosition, chartWidth, chartHeight    topPosition = topPosition + chartHeight + chartSpacing    ' 4. Create Doughnut Chart: Revenue by State    CreateChartFromPivot wsCharts, "PivotTable4", xlDoughnut, "Revenue by State", 10, topPosition, chartWidth, chartHeight    topPosition = topPosition + chartHeight + chartSpacing    ' 5. Create Line Chart: Price per Unit Over Time    CreateChartFromPivot wsCharts, "PivotTable5", xlLine, "Price per Unit Over Time", 10, topPosition, chartWidth, chartHeight    topPosition = topPosition + chartHeight + chartSpacing    MsgBox "Pivot tables and charts created successfully on the 'Charts' sheet!", vbInformationEnd SubSub CreateChartFromPivot(ws As Worksheet, pivotTableName As String, chartType As XlChartType, chartTitle As String, leftPos As Double, topPos As Double, width As Double, height As Double)    Dim chartObj As ChartObject    Dim pvt As PivotTable    ' Get the pivot table    Set pvt = ws.PivotTables(pivotTableName)    ' Add chart object and link it to the pivot table    Set chartObj = ws.ChartObjects.Add(leftPos, topPos, width, height)    With chartObj.Chart        .SetSourceData Source:=pvt.TableRange2        .chartType = chartType        .HasTitle = True        .chartTitle.Text = chartTitle    End WithEnd Sub